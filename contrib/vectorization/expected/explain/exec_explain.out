-- query plan test for check whether is vectorization plan
-- create table
CREATE TABLE IF NOT EXISTS t1 (a INT, b INT) DISTRIBUTED BY(a);
CREATE TABLE IF NOT EXISTS t2 (a INT, b INT) DISTRIBUTED RANDOMLY;
CREATE TABLE IF NOT EXISTS t3 (a INT, b INT) DISTRIBUTED REPLICATED;
-- SET VECTORIZATION ON
SET vector.enable_vectorization=ON;
-- load data
INSERT INTO t1 VALUES (1, 2), (2, 3),(3, 4);
INSERT INTO t2 VALUES (1, 2), (2, 3),(3, 4);
INSERT INTO t3 VALUES (1, 2), (2, 3),(3, 4);
-- analyze table
ANALYZE t1;
ANALYZE t2;
ANALYZE t3;
-- explain query
EXPLAIN (costs, verbose) SELECT * FROM t1;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 3:1  (slice1; segments: 3)  (cost=0.00..431.00 rows=3 width=8)
   Output: a, b
   ->  Seq Scan on public.t1  (cost=0.00..431.00 rows=1 width=8)
         Output: a, b
 Optimizer: Pivotal Optimizer (GPORCA)
(5 rows)

EXPLAIN (costs, verbose) SELECT * FROM t2;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 3:1  (slice1; segments: 3)  (cost=0.00..431.00 rows=3 width=8)
   Output: a, b
   ->  Seq Scan on public.t2  (cost=0.00..431.00 rows=1 width=8)
         Output: a, b
 Optimizer: Pivotal Optimizer (GPORCA)
(5 rows)

EXPLAIN (costs, verbose) SELECT * FROM t3;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 1:1  (slice1; segments: 1)  (cost=0.00..431.00 rows=3 width=8)
   Output: a, b
   ->  Seq Scan on public.t3  (cost=0.00..431.00 rows=9 width=8)
         Output: a, b
 Optimizer: Pivotal Optimizer (GPORCA)
(5 rows)

EXPLAIN (costs, verbose) SELECT * FROM t1 WHERE a=1;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 1:1  (slice1; segments: 1)  (cost=0.00..431.00 rows=1 width=8)
   Output: a, b
   ->  Seq Scan on public.t1  (cost=0.00..431.00 rows=1 width=8)
         Output: a, b
         Filter: (t1.a = 1)
 Optimizer: Pivotal Optimizer (GPORCA)
(6 rows)

EXPLAIN (costs, verbose) SELECT * FROM t2 WHERE a=1;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 3:1  (slice1; segments: 3)  (cost=0.00..431.00 rows=1 width=8)
   Output: a, b
   ->  Seq Scan on public.t2  (cost=0.00..431.00 rows=1 width=8)
         Output: a, b
         Filter: (t2.a = 1)
 Optimizer: Pivotal Optimizer (GPORCA)
(6 rows)

EXPLAIN (costs, verbose) SELECT * FROM t3 WHERE a=1;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 1:1  (slice1; segments: 1)  (cost=0.00..431.00 rows=1 width=8)
   Output: a, b
   ->  Seq Scan on public.t3  (cost=0.00..431.00 rows=3 width=8)
         Output: a, b
         Filter: (t3.a = 1)
 Optimizer: Pivotal Optimizer (GPORCA)
(6 rows)

EXPLAIN (costs, verbose) SELECT * FROM t1 WHERE a IS NOT NULL;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 3:1  (slice1; segments: 3)  (cost=0.00..431.00 rows=3 width=8)
   Output: a, b
   ->  Seq Scan on public.t1  (cost=0.00..431.00 rows=1 width=8)
         Output: a, b
         Filter: (NOT (t1.a IS NULL))
 Optimizer: Pivotal Optimizer (GPORCA)
(6 rows)

EXPLAIN (costs, verbose) SELECT * FROM t2 WHERE a IS NOT NULL;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 3:1  (slice1; segments: 3)  (cost=0.00..431.00 rows=3 width=8)
   Output: a, b
   ->  Seq Scan on public.t2  (cost=0.00..431.00 rows=1 width=8)
         Output: a, b
         Filter: (NOT (t2.a IS NULL))
 Optimizer: Pivotal Optimizer (GPORCA)
(6 rows)

EXPLAIN (costs, verbose) SELECT * FROM t3 WHERE a IS NOT NULL;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 1:1  (slice1; segments: 1)  (cost=0.00..431.00 rows=3 width=8)
   Output: a, b
   ->  Seq Scan on public.t3  (cost=0.00..431.00 rows=9 width=8)
         Output: a, b
         Filter: (NOT (t3.a IS NULL))
 Optimizer: Pivotal Optimizer (GPORCA)
(6 rows)

EXPLAIN (costs, verbose) SELECT * FROM t1 WHERE a IS NULL;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 1:1  (slice1; segments: 1)  (cost=0.00..431.00 rows=1 width=8)
   Output: a, b
   ->  Seq Scan on public.t1  (cost=0.00..431.00 rows=1 width=8)
         Output: a, b
         Filter: (t1.a IS NULL)
 Optimizer: Pivotal Optimizer (GPORCA)
(6 rows)

EXPLAIN (costs, verbose) SELECT * FROM t2 WHERE a IS NULL;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 3:1  (slice1; segments: 3)  (cost=0.00..431.00 rows=1 width=8)
   Output: a, b
   ->  Seq Scan on public.t2  (cost=0.00..431.00 rows=1 width=8)
         Output: a, b
         Filter: (t2.a IS NULL)
 Optimizer: Pivotal Optimizer (GPORCA)
(6 rows)

EXPLAIN (costs, verbose) SELECT * FROM t3 WHERE a IS NULL;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 1:1  (slice1; segments: 1)  (cost=0.00..431.00 rows=1 width=8)
   Output: a, b
   ->  Seq Scan on public.t3  (cost=0.00..431.00 rows=3 width=8)
         Output: a, b
         Filter: (t3.a IS NULL)
 Optimizer: Pivotal Optimizer (GPORCA)
(6 rows)

EXPLAIN (costs, verbose) SELECT * FROM t1 ORDER BY a;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 3:1  (slice1; segments: 3)  (cost=0.00..431.00 rows=3 width=8)
   Output: a, b
   Merge Key: a
   ->  Sort  (cost=0.00..431.00 rows=1 width=8)
         Output: a, b
         Sort Key: t1.a
         ->  Seq Scan on public.t1  (cost=0.00..431.00 rows=1 width=8)
               Output: a, b
 Optimizer: Pivotal Optimizer (GPORCA)
(9 rows)

EXPLAIN (costs, verbose) SELECT * FROM t2 ORDER BY a;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 3:1  (slice1; segments: 3)  (cost=0.00..431.00 rows=3 width=8)
   Output: a, b
   Merge Key: a
   ->  Sort  (cost=0.00..431.00 rows=1 width=8)
         Output: a, b
         Sort Key: t2.a
         ->  Seq Scan on public.t2  (cost=0.00..431.00 rows=1 width=8)
               Output: a, b
 Optimizer: Pivotal Optimizer (GPORCA)
(9 rows)

EXPLAIN (costs, verbose) SELECT * FROM t3 ORDER BY a;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 1:1  (slice1; segments: 1)  (cost=0.00..431.00 rows=3 width=8)
   Output: a, b
   Merge Key: a
   ->  Sort  (cost=0.00..431.00 rows=9 width=8)
         Output: a, b
         Sort Key: t3.a
         ->  Seq Scan on public.t3  (cost=0.00..431.00 rows=9 width=8)
               Output: a, b
 Optimizer: Pivotal Optimizer (GPORCA)
(9 rows)

EXPLAIN (costs, verbose) SELECT * FROM t1 ORDER BY b;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 3:1  (slice1; segments: 3)  (cost=0.00..431.00 rows=3 width=8)
   Output: a, b
   Merge Key: b
   ->  Sort  (cost=0.00..431.00 rows=1 width=8)
         Output: a, b
         Sort Key: t1.b
         ->  Seq Scan on public.t1  (cost=0.00..431.00 rows=1 width=8)
               Output: a, b
 Optimizer: Pivotal Optimizer (GPORCA)
(9 rows)

EXPLAIN (costs, verbose) SELECT * FROM t2 ORDER BY b;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 3:1  (slice1; segments: 3)  (cost=0.00..431.00 rows=3 width=8)
   Output: a, b
   Merge Key: b
   ->  Sort  (cost=0.00..431.00 rows=1 width=8)
         Output: a, b
         Sort Key: t2.b
         ->  Seq Scan on public.t2  (cost=0.00..431.00 rows=1 width=8)
               Output: a, b
 Optimizer: Pivotal Optimizer (GPORCA)
(9 rows)

EXPLAIN (costs, verbose) SELECT * FROM t3 ORDER BY b;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 1:1  (slice1; segments: 1)  (cost=0.00..431.00 rows=3 width=8)
   Output: a, b
   Merge Key: b
   ->  Sort  (cost=0.00..431.00 rows=9 width=8)
         Output: a, b
         Sort Key: t3.b
         ->  Seq Scan on public.t3  (cost=0.00..431.00 rows=9 width=8)
               Output: a, b
 Optimizer: Pivotal Optimizer (GPORCA)
(9 rows)

EXPLAIN (costs, verbose) SELECT * FROM t1 ORDER BY a,b;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 3:1  (slice1; segments: 3)  (cost=0.00..431.00 rows=3 width=8)
   Output: a, b
   Merge Key: a, b
   ->  Sort  (cost=0.00..431.00 rows=1 width=8)
         Output: a, b
         Sort Key: t1.a, t1.b
         ->  Seq Scan on public.t1  (cost=0.00..431.00 rows=1 width=8)
               Output: a, b
 Optimizer: Pivotal Optimizer (GPORCA)
(9 rows)

EXPLAIN (costs, verbose) SELECT * FROM t2 ORDER BY a,b;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 3:1  (slice1; segments: 3)  (cost=0.00..431.00 rows=3 width=8)
   Output: a, b
   Merge Key: a, b
   ->  Sort  (cost=0.00..431.00 rows=1 width=8)
         Output: a, b
         Sort Key: t2.a, t2.b
         ->  Seq Scan on public.t2  (cost=0.00..431.00 rows=1 width=8)
               Output: a, b
 Optimizer: Pivotal Optimizer (GPORCA)
(9 rows)

EXPLAIN (costs, verbose) SELECT * FROM t3 ORDER BY a,b;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 1:1  (slice1; segments: 1)  (cost=0.00..431.00 rows=3 width=8)
   Output: a, b
   Merge Key: a, b
   ->  Sort  (cost=0.00..431.00 rows=9 width=8)
         Output: a, b
         Sort Key: t3.a, t3.b
         ->  Seq Scan on public.t3  (cost=0.00..431.00 rows=9 width=8)
               Output: a, b
 Optimizer: Pivotal Optimizer (GPORCA)
(9 rows)

EXPLAIN (costs, verbose) SELECT a+1 FROM t1;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 3:1  (slice1; segments: 3)  (cost=0.00..431.00 rows=3 width=4)
   Output: ((a + 1))
   ->  Seq Scan on public.t1  (cost=0.00..431.00 rows=1 width=4)
         Output: (a + 1)
 Optimizer: Pivotal Optimizer (GPORCA)
(5 rows)

EXPLAIN (costs, verbose) SELECT a+1 FROM t2;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 3:1  (slice1; segments: 3)  (cost=0.00..431.00 rows=3 width=4)
   Output: ((a + 1))
   ->  Seq Scan on public.t2  (cost=0.00..431.00 rows=1 width=4)
         Output: (a + 1)
 Optimizer: Pivotal Optimizer (GPORCA)
(5 rows)

EXPLAIN (costs, verbose) SELECT a+1 FROM t3;
                                     QUERY PLAN                                     
------------------------------------------------------------------------------------
 Result  (cost=0.00..431.00 rows=3 width=4)
   Output: (a + 1)
   ->  Gather Motion 1:1  (slice1; segments: 1)  (cost=0.00..431.00 rows=3 width=4)
         Output: a
         ->  Seq Scan on public.t3  (cost=0.00..431.00 rows=9 width=4)
               Output: a
 Optimizer: Pivotal Optimizer (GPORCA)
(7 rows)

EXPLAIN (costs, verbose) SELECT a+b FROM t1;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 3:1  (slice1; segments: 3)  (cost=0.00..431.00 rows=3 width=4)
   Output: ((a + b))
   ->  Seq Scan on public.t1  (cost=0.00..431.00 rows=1 width=8)
         Output: (a + b)
 Optimizer: Pivotal Optimizer (GPORCA)
(5 rows)

EXPLAIN (costs, verbose) SELECT a+b FROM t2;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 3:1  (slice1; segments: 3)  (cost=0.00..431.00 rows=3 width=4)
   Output: ((a + b))
   ->  Seq Scan on public.t2  (cost=0.00..431.00 rows=1 width=8)
         Output: (a + b)
 Optimizer: Pivotal Optimizer (GPORCA)
(5 rows)

EXPLAIN (costs, verbose) SELECT a+b FROM t3;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 1:1  (slice1; segments: 1)  (cost=0.00..431.00 rows=3 width=4)
   Output: ((a + b))
   ->  Seq Scan on public.t3  (cost=0.00..431.00 rows=9 width=8)
         Output: (a + b)
 Optimizer: Pivotal Optimizer (GPORCA)
(5 rows)

EXPLAIN (costs, verbose) SELECT a*2 FROM t1;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 3:1  (slice1; segments: 3)  (cost=0.00..431.00 rows=3 width=4)
   Output: ((a * 2))
   ->  Seq Scan on public.t1  (cost=0.00..431.00 rows=1 width=4)
         Output: (a * 2)
 Optimizer: Pivotal Optimizer (GPORCA)
(5 rows)

EXPLAIN (costs, verbose) SELECT a*2 FROM t2;
                                  QUERY PLAN                                  
------------------------------------------------------------------------------
 Gather Motion 3:1  (slice1; segments: 3)  (cost=0.00..431.00 rows=3 width=4)
   Output: ((a * 2))
   ->  Seq Scan on public.t2  (cost=0.00..431.00 rows=1 width=4)
         Output: (a * 2)
 Optimizer: Pivotal Optimizer (GPORCA)
(5 rows)

EXPLAIN (costs, verbose) SELECT a*2 FROM t3;
                                     QUERY PLAN                                     
------------------------------------------------------------------------------------
 Result  (cost=0.00..431.00 rows=3 width=4)
   Output: (a * 2)
   ->  Gather Motion 1:1  (slice1; segments: 1)  (cost=0.00..431.00 rows=3 width=4)
         Output: a
         ->  Seq Scan on public.t3  (cost=0.00..431.00 rows=9 width=4)
               Output: a
 Optimizer: Pivotal Optimizer (GPORCA)
(7 rows)

-- drop table
DROP TABLE if EXISTS t1;
DROP TABLE if EXISTS t2;
DROP TABLE if EXISTS t3;
