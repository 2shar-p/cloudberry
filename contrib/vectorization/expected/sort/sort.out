-- test sort executor
-- set vectorization on
SET vector.enable_vectorization=ON;
SET vector.max_batch_size = 13;
-- create table
CREATE TABLE IF NOT EXISTS t1 (a INT, b INT) DISTRIBUTED BY(a);
-- load data
INSERT INTO t1 SELECT 1000 - i, i * i - i  FROM GENERATE_SERIES(1, 100)i;
-- query
SELECT * FROM t1 ORDER BY a;
  a  |  b   
-----+------
 900 | 9900
 901 | 9702
 902 | 9506
 903 | 9312
 904 | 9120
 905 | 8930
 906 | 8742
 907 | 8556
 908 | 8372
 909 | 8190
 910 | 8010
 911 | 7832
 912 | 7656
 913 | 7482
 914 | 7310
 915 | 7140
 916 | 6972
 917 | 6806
 918 | 6642
 919 | 6480
 920 | 6320
 921 | 6162
 922 | 6006
 923 | 5852
 924 | 5700
 925 | 5550
 926 | 5402
 927 | 5256
 928 | 5112
 929 | 4970
 930 | 4830
 931 | 4692
 932 | 4556
 933 | 4422
 934 | 4290
 935 | 4160
 936 | 4032
 937 | 3906
 938 | 3782
 939 | 3660
 940 | 3540
 941 | 3422
 942 | 3306
 943 | 3192
 944 | 3080
 945 | 2970
 946 | 2862
 947 | 2756
 948 | 2652
 949 | 2550
 950 | 2450
 951 | 2352
 952 | 2256
 953 | 2162
 954 | 2070
 955 | 1980
 956 | 1892
 957 | 1806
 958 | 1722
 959 | 1640
 960 | 1560
 961 | 1482
 962 | 1406
 963 | 1332
 964 | 1260
 965 | 1190
 966 | 1122
 967 | 1056
 968 |  992
 969 |  930
 970 |  870
 971 |  812
 972 |  756
 973 |  702
 974 |  650
 975 |  600
 976 |  552
 977 |  506
 978 |  462
 979 |  420
 980 |  380
 981 |  342
 982 |  306
 983 |  272
 984 |  240
 985 |  210
 986 |  182
 987 |  156
 988 |  132
 989 |  110
 990 |   90
 991 |   72
 992 |   56
 993 |   42
 994 |   30
 995 |   20
 996 |   12
 997 |    6
 998 |    2
 999 |    0
(100 rows)

SELECT * FROM t1 ORDER BY b;
  a  |  b   
-----+------
 999 |    0
 998 |    2
 997 |    6
 996 |   12
 995 |   20
 994 |   30
 993 |   42
 992 |   56
 991 |   72
 990 |   90
 989 |  110
 988 |  132
 987 |  156
 986 |  182
 985 |  210
 984 |  240
 983 |  272
 982 |  306
 981 |  342
 980 |  380
 979 |  420
 978 |  462
 977 |  506
 976 |  552
 975 |  600
 974 |  650
 973 |  702
 972 |  756
 971 |  812
 970 |  870
 969 |  930
 968 |  992
 967 | 1056
 966 | 1122
 965 | 1190
 964 | 1260
 963 | 1332
 962 | 1406
 961 | 1482
 960 | 1560
 959 | 1640
 958 | 1722
 957 | 1806
 956 | 1892
 955 | 1980
 954 | 2070
 953 | 2162
 952 | 2256
 951 | 2352
 950 | 2450
 949 | 2550
 948 | 2652
 947 | 2756
 946 | 2862
 945 | 2970
 944 | 3080
 943 | 3192
 942 | 3306
 941 | 3422
 940 | 3540
 939 | 3660
 938 | 3782
 937 | 3906
 936 | 4032
 935 | 4160
 934 | 4290
 933 | 4422
 932 | 4556
 931 | 4692
 930 | 4830
 929 | 4970
 928 | 5112
 927 | 5256
 926 | 5402
 925 | 5550
 924 | 5700
 923 | 5852
 922 | 6006
 921 | 6162
 920 | 6320
 919 | 6480
 918 | 6642
 917 | 6806
 916 | 6972
 915 | 7140
 914 | 7310
 913 | 7482
 912 | 7656
 911 | 7832
 910 | 8010
 909 | 8190
 908 | 8372
 907 | 8556
 906 | 8742
 905 | 8930
 904 | 9120
 903 | 9312
 902 | 9506
 901 | 9702
 900 | 9900
(100 rows)

-- drop table
DROP TABLE t1;
-- create table
CREATE TABLE IF NOT EXISTS t1 (a INT, b INT) DISTRIBUTED BY(a);
-- load data
INSERT INTO t1 SELECT i % 11, i * (i / 3) FROM GENERATE_SERIES(1, 100)i;
-- query
SELECT * FROM t1 ORDER BY a,b;
 a  |  b   
----+------
  0 |   33
  0 |  154
  0 |  363
  0 |  616
  0 |  990
  0 | 1452
  0 | 1925
  0 | 2552
  0 | 3267
  1 |    0
  1 |   48
  1 |  161
  1 |  374
  1 |  675
  1 | 1008
  1 | 1474
  1 | 2028
  1 | 2581
  1 | 3300
  2 |    0
  2 |   52
  2 |  192
  2 |  385
  2 |  690
  2 | 1083
  2 | 1496
  2 | 2054
  2 | 2700
  3 |    3
  3 |   56
  3 |  200
  3 |  432
  3 |  705
  3 | 1102
  3 | 1587
  3 | 2080
  3 | 2730
  4 |    4
  4 |   75
  4 |  208
  4 |  444
  4 |  768
  4 | 1121
  4 | 1610
  4 | 2187
  4 | 2760
  5 |    5
  5 |   80
  5 |  243
  5 |  456
  5 |  784
  5 | 1200
  5 | 1633
  5 | 2214
  5 | 2883
  6 |   12
  6 |   85
  6 |  252
  6 |  507
  6 |  800
  6 | 1220
  6 | 1728
  6 | 2241
  6 | 2914
  7 |   14
  7 |  108
  7 |  261
  7 |  520
  7 |  867
  7 | 1240
  7 | 1752
  7 | 2352
  7 | 2945
  8 |   16
  8 |  114
  8 |  300
  8 |  533
  8 |  884
  8 | 1323
  8 | 1776
  8 | 2380
  8 | 3072
  9 |   27
  9 |  120
  9 |  310
  9 |  588
  9 |  901
  9 | 1344
  9 | 1875
  9 | 2408
  9 | 3104
 10 |   30
 10 |  147
 10 |  320
 10 |  602
 10 |  972
 10 | 1365
 10 | 1900
 10 | 2523
 10 | 3136
(100 rows)

-- drop table
DROP TABLE t1;
CREATE TABLE IF NOT EXISTS t1 (a INT, b TEXT) WITH(APPENDONLY=true, ORIENTATION=column)  DISTRIBUTED BY(a);
-- load data
INSERT INTO t1 SELECT i, i::text FROM GENERATE_SERIES(110, 150)i;
INSERT INTO t1 SELECT i % 7, i::text FROM GENERATE_SERIES(1, 100)i;
-- query
SELECT * FROM t1 ORDER BY b;
  a  |  b  
-----+-----
   1 | 1
   3 | 10
   2 | 100
   4 | 11
 110 | 110
 111 | 111
 112 | 112
 113 | 113
 114 | 114
 115 | 115
 116 | 116
 117 | 117
 118 | 118
 119 | 119
   5 | 12
 120 | 120
 121 | 121
 122 | 122
 123 | 123
 124 | 124
 125 | 125
 126 | 126
 127 | 127
 128 | 128
 129 | 129
   6 | 13
 130 | 130
 131 | 131
 132 | 132
 133 | 133
 134 | 134
 135 | 135
 136 | 136
 137 | 137
 138 | 138
 139 | 139
   0 | 14
 140 | 140
 141 | 141
 142 | 142
 143 | 143
 144 | 144
 145 | 145
 146 | 146
 147 | 147
 148 | 148
 149 | 149
   1 | 15
 150 | 150
   2 | 16
   3 | 17
   4 | 18
   5 | 19
   2 | 2
   6 | 20
   0 | 21
   1 | 22
   2 | 23
   3 | 24
   4 | 25
   5 | 26
   6 | 27
   0 | 28
   1 | 29
   3 | 3
   2 | 30
   3 | 31
   4 | 32
   5 | 33
   6 | 34
   0 | 35
   1 | 36
   2 | 37
   3 | 38
   4 | 39
   4 | 4
   5 | 40
   6 | 41
   0 | 42
   1 | 43
   2 | 44
   3 | 45
   4 | 46
   5 | 47
   6 | 48
   0 | 49
   5 | 5
   1 | 50
   2 | 51
   3 | 52
   4 | 53
   5 | 54
   6 | 55
   0 | 56
   1 | 57
   2 | 58
   3 | 59
   6 | 6
   4 | 60
   5 | 61
   6 | 62
   0 | 63
   1 | 64
   2 | 65
   3 | 66
   4 | 67
   5 | 68
   6 | 69
   0 | 7
   0 | 70
   1 | 71
   2 | 72
   3 | 73
   4 | 74
   5 | 75
   6 | 76
   0 | 77
   1 | 78
   2 | 79
   1 | 8
   3 | 80
   4 | 81
   5 | 82
   6 | 83
   0 | 84
   1 | 85
   2 | 86
   3 | 87
   4 | 88
   5 | 89
   2 | 9
   6 | 90
   0 | 91
   1 | 92
   2 | 93
   3 | 94
   4 | 95
   5 | 96
   6 | 97
   0 | 98
   1 | 99
(141 rows)

SELECT * FROM t1 ORDER BY a,b;
  a  |  b  
-----+-----
   0 | 14
   0 | 21
   0 | 28
   0 | 35
   0 | 42
   0 | 49
   0 | 56
   0 | 63
   0 | 7
   0 | 70
   0 | 77
   0 | 84
   0 | 91
   0 | 98
   1 | 1
   1 | 15
   1 | 22
   1 | 29
   1 | 36
   1 | 43
   1 | 50
   1 | 57
   1 | 64
   1 | 71
   1 | 78
   1 | 8
   1 | 85
   1 | 92
   1 | 99
   2 | 100
   2 | 16
   2 | 2
   2 | 23
   2 | 30
   2 | 37
   2 | 44
   2 | 51
   2 | 58
   2 | 65
   2 | 72
   2 | 79
   2 | 86
   2 | 9
   2 | 93
   3 | 10
   3 | 17
   3 | 24
   3 | 3
   3 | 31
   3 | 38
   3 | 45
   3 | 52
   3 | 59
   3 | 66
   3 | 73
   3 | 80
   3 | 87
   3 | 94
   4 | 11
   4 | 18
   4 | 25
   4 | 32
   4 | 39
   4 | 4
   4 | 46
   4 | 53
   4 | 60
   4 | 67
   4 | 74
   4 | 81
   4 | 88
   4 | 95
   5 | 12
   5 | 19
   5 | 26
   5 | 33
   5 | 40
   5 | 47
   5 | 5
   5 | 54
   5 | 61
   5 | 68
   5 | 75
   5 | 82
   5 | 89
   5 | 96
   6 | 13
   6 | 20
   6 | 27
   6 | 34
   6 | 41
   6 | 48
   6 | 55
   6 | 6
   6 | 62
   6 | 69
   6 | 76
   6 | 83
   6 | 90
   6 | 97
 110 | 110
 111 | 111
 112 | 112
 113 | 113
 114 | 114
 115 | 115
 116 | 116
 117 | 117
 118 | 118
 119 | 119
 120 | 120
 121 | 121
 122 | 122
 123 | 123
 124 | 124
 125 | 125
 126 | 126
 127 | 127
 128 | 128
 129 | 129
 130 | 130
 131 | 131
 132 | 132
 133 | 133
 134 | 134
 135 | 135
 136 | 136
 137 | 137
 138 | 138
 139 | 139
 140 | 140
 141 | 141
 142 | 142
 143 | 143
 144 | 144
 145 | 145
 146 | 146
 147 | 147
 148 | 148
 149 | 149
 150 | 150
(141 rows)

-- drop table
DROP TABLE t1;
CREATE COLLATION c1 (LOCALE = 'en_US.UTF-8');
CREATE TABLE test_locale (a char(8) COLLATE "C", b char(8) COLLATE c1) using ao_column;


INSERT INTO test_locale VALUES ('XXXX', 'A');
INSERT INTO test_locale VALUES ('ABAB', 'b');
INSERT INTO test_locale VALUES ('ABAB', 'c');
INSERT INTO test_locale VALUES ('BBBB', 'D');
INSERT INTO test_locale VALUES ('BBBB', 'e');
INSERT INTO test_locale VALUES ('bbbb', 'F');
INSERT INTO test_locale VALUES ('cccc', 'g');
INSERT INTO test_locale VALUES ('cccc', 'h');
INSERT INTO test_locale VALUES ('CCCC', 'I');
INSERT INTO test_locale VALUES ('CCCC', 'j');
select a from test_locale order by a;
    a     
----------
 ABAB    
 ABAB    
 BBBB    
 BBBB    
 CCCC    
 CCCC    
 XXXX    
 bbbb    
 cccc    
 cccc    
(10 rows)

select b from test_locale order by b;
    b     
----------
 A       
 b       
 c       
 D       
 F       
 e       
 g       
 h       
 I       
 j       
(10 rows)

drop table test_locale;
drop COLLATION c1;
