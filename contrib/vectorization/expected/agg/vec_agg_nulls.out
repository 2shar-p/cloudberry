SET vector.enable_vectorization = on;
SET


-- *** hash agg ***
SET optimizer = off;
SET
SET enable_groupagg = off;
SET

-- normal argument
EXPLAIN (costs off) SELECT count(cint4), sum(cint4), avg(cint4), min(cint4), max(cint4), count(cint8), sum(cint8), avg(cint8), min(cint8), max(cint8), count(cint2), sum(cint2), avg(cint2), min(cint2), max(cint2), count(cdate), min(cdate), max(cdate), count(cts)  , min(cts)  , max(cts)  , count(ctext), min(ctext), max(ctext), count(), grpkey FROM tnulls GROUP BY grpkey ORDER BY grpkey;
 QUERY PLAN
---------------------------------------------------------------------
 Gather VecMotion 2:1  (slice2; segments: 2)
   Merge Key: tnulls.grpkey
   ->  Vec Sort
         Sort Key: tnulls.grpkey
         ->  Vec HashAggregate
               Group Key: tnulls.grpkey
               ->  Redistribute VecMotion 2:2  (slice1; segments: 2)
                     Hash Key: tnulls.grpkey
                     ->  Vec HashAggregate
                           Group Key: tnulls.grpkey
                           ->  Vec Seq Scan on tnulls
 Optimizer: Postgres query optimizer
(12 rows)

SELECT count(cint4), sum(cint4), avg(cint4), min(cint4), max(cint4), count(cint8), sum(cint8), avg(cint8), min(cint8), max(cint8), count(cint2), sum(cint2), avg(cint2), min(cint2), max(cint2), count(cdate), min(cdate), max(cdate), count(cts)  , min(cts)  , max(cts)  , count(ctext), min(ctext), max(ctext), count(), grpkey FROM tnulls GROUP BY grpkey ORDER BY grpkey;
 count | sum | avg | min | max | count | sum | avg | min | max | count | sum | avg | min | max | count | min | max | count | min | max | count | min | max | count | grpkey
-------+-----+-----+-----+-----+-------+-----+-----+-----+-----+-------+-----+-----+-----+-----+-------+-----+-----+-------+-----+-----+-------+-----+-----+-------+--------
 0     |     |     |     |     | 0     |     |     |     |     | 0     |     |     |     |     | 0     |     |     | 0     |     |     | 0     |     |     | 2     |
(1 row)

-- distinct argument
EXPLAIN (costs off) SELECT count(DISTINCT cint4), sum(DISTINCT cint4), avg(DISTINCT cint4), grpkey FROM tnulls GROUP BY grpkey ORDER BY grpkey;
 QUERY PLAN
---------------------------------------------------------------------------
 Gather VecMotion 2:1  (slice2; segments: 2)
   Merge Key: tnulls.grpkey
   ->  Vec Sort
         Sort Key: tnulls.grpkey
         ->  Vec HashAggregate
               Group Key: tnulls.grpkey
               ->  Vec HashAggregate
                     Group Key: tnulls.grpkey, tnulls.cint4
                     ->  Redistribute VecMotion 2:2  (slice1; segments: 2)
                           Hash Key: tnulls.grpkey
                           ->  Vec HashAggregate
                                 Group Key: tnulls.grpkey, tnulls.cint4
                                 ->  Vec Seq Scan on tnulls
 Optimizer: Postgres query optimizer
(14 rows)

EXPLAIN (costs off) SELECT count(DISTINCT cint8), sum(DISTINCT cint8), avg(DISTINCT cint8), grpkey FROM tnulls GROUP BY grpkey ORDER BY grpkey;
 QUERY PLAN
---------------------------------------------------------------------------
 Gather VecMotion 2:1  (slice2; segments: 2)
   Merge Key: tnulls.grpkey
   ->  Vec Sort
         Sort Key: tnulls.grpkey
         ->  Vec HashAggregate
               Group Key: tnulls.grpkey
               ->  Vec HashAggregate
                     Group Key: tnulls.grpkey, tnulls.cint8
                     ->  Redistribute VecMotion 2:2  (slice1; segments: 2)
                           Hash Key: tnulls.grpkey
                           ->  Vec HashAggregate
                                 Group Key: tnulls.grpkey, tnulls.cint8
                                 ->  Vec Seq Scan on tnulls
 Optimizer: Postgres query optimizer
(14 rows)

EXPLAIN (costs off) SELECT count(DISTINCT ctext), grpkey FROM tnulls GROUP BY grpkey ORDER BY grpkey;
 QUERY PLAN
---------------------------------------------------------------------------
 Gather VecMotion 2:1  (slice2; segments: 2)
   Merge Key: tnulls.grpkey
   ->  Vec Sort
         Sort Key: tnulls.grpkey
         ->  Vec HashAggregate
               Group Key: tnulls.grpkey
               ->  Vec HashAggregate
                     Group Key: tnulls.grpkey, tnulls.ctext
                     ->  Redistribute VecMotion 2:2  (slice1; segments: 2)
                           Hash Key: tnulls.grpkey
                           ->  Vec HashAggregate
                                 Group Key: tnulls.grpkey, tnulls.ctext
                                 ->  Vec Seq Scan on tnulls
 Optimizer: Postgres query optimizer
(14 rows)

SELECT count(DISTINCT cint4), sum(DISTINCT cint4), avg(DISTINCT cint4), grpkey FROM tnulls GROUP BY grpkey ORDER BY grpkey;
 count | sum | avg | grpkey
-------+-----+-----+--------
 0     |     |     |
(1 row)
SELECT count(DISTINCT cint8), sum(DISTINCT cint8), avg(DISTINCT cint8), grpkey FROM tnulls GROUP BY grpkey ORDER BY grpkey;
 count | sum | avg | grpkey
-------+-----+-----+--------
 0     |     |     |
(1 row)
SELECT count(DISTINCT cint2), sum(DISTINCT cint2), avg(DISTINCT cint2), grpkey FROM tnulls GROUP BY grpkey ORDER BY grpkey;
 count | sum | avg | grpkey
-------+-----+-----+--------
 0     |     |     |
(1 row)
SELECT count(DISTINCT ctext), grpkey FROM tnulls GROUP BY grpkey ORDER BY grpkey;
 count | grpkey
-------+--------
 0     |
(1 row)


-- *** plain agg ***

-- single plain agg
SET optimizer = on;
SET

-- normal argument
EXPLAIN (costs off) SELECT count(cint4), sum(cint4), avg(cint4), min(cint4), max(cint4), count(cint8), sum(cint8), avg(cint8), min(cint8), max(cint8), count(cint2), sum(cint2), avg(cint2), min(cint2), max(cint2), count(cdate), min(cdate), max(cdate), count(cts)  , min(cts)  , max(cts)  , count(ctext), min(ctext), max(ctext), count() FROM tnulls;
 QUERY PLAN
---------------------------------------------------
 Vec Aggregate
   ->  Gather VecMotion 2:1  (slice1; segments: 2)
         ->  Vec Seq Scan on tnulls
 Optimizer: Pivotal Optimizer (GPORCA)
(4 rows)

SELECT count(cint4), sum(cint4), avg(cint4), min(cint4), max(cint4), count(cint8), sum(cint8), avg(cint8), min(cint8), max(cint8), count(cint2), sum(cint2), avg(cint2), min(cint2), max(cint2), count(cdate), min(cdate), max(cdate), count(cts)  , min(cts)  , max(cts)  , count(ctext), min(ctext), max(ctext), count() FROM tnulls;
 count | sum | avg | min | max | count | sum | avg | min | max | count | sum | avg | min | max | count | min | max | count | min | max | count | min | max | count
-------+-----+-----+-----+-----+-------+-----+-----+-----+-----+-------+-----+-----+-----+-----+-------+-----+-----+-------+-----+-----+-------+-----+-----+-------
 0     |     |     |     |     | 0     |     |     |     |     | 0     |     |     |     |     | 0     |     |     | 0     |     |     | 0     |     |     | 2
(1 row)


-- distinct argument
EXPLAIN (costs off) SELECT count(DISTINCT cint4), sum(DISTINCT cint4), avg(DISTINCT cint4) FROM tnulls;
 QUERY PLAN
---------------------------------------------------
 Vec Aggregate
   ->  Gather VecMotion 2:1  (slice1; segments: 2)
         ->  Vec Seq Scan on tnulls
 Optimizer: Pivotal Optimizer (GPORCA)
(4 rows)

EXPLAIN (costs off) SELECT count(DISTINCT cint8), sum(DISTINCT cint8), avg(DISTINCT cint8) FROM tnulls;
 QUERY PLAN
---------------------------------------------------
 Vec Aggregate
   ->  Gather VecMotion 2:1  (slice1; segments: 2)
         ->  Vec Seq Scan on tnulls
 Optimizer: Pivotal Optimizer (GPORCA)
(4 rows)

EXPLAIN (costs off) SELECT count(DISTINCT ctext) FROM tnulls;
 QUERY PLAN
---------------------------------------------------
 Vec Aggregate
   ->  Gather VecMotion 2:1  (slice1; segments: 2)
         ->  Vec Seq Scan on tnulls
 Optimizer: Pivotal Optimizer (GPORCA)
(4 rows)

SELECT count(DISTINCT cint4), sum(DISTINCT cint4), avg(DISTINCT cint4) FROM tnulls;
 count | sum | avg
-------+-----+-----
 0     |     |
(1 row)
SELECT count(DISTINCT cint8), sum(DISTINCT cint8), avg(DISTINCT cint8) FROM tnulls;
 count | sum | avg
-------+-----+-----
 0     |     |
(1 row)
SELECT count(DISTINCT cint2), sum(DISTINCT cint2), avg(DISTINCT cint2) FROM tnulls;
 count | sum | avg
-------+-----+-----
 0     |     |
(1 row)
SELECT count(DISTINCT ctext) FROM tnulls;
 count
-------
 0
(1 row)


-- double plain aggs
SET optimizer = off;
SET

-- normal argument
EXPLAIN (costs off) SELECT count(cint4), sum(cint4), avg(cint4), min(cint4), max(cint4), count(cint8), sum(cint8), avg(cint8), min(cint8), max(cint8), count(cint2), sum(cint2), avg(cint2), min(cint2), max(cint2), count(cdate), min(cdate), max(cdate), count(cts)  , min(cts)  , max(cts)  , count(ctext), min(ctext), max(ctext), count() FROM tnulls;
 QUERY PLAN
---------------------------------------------------
 Vec Aggregate
   ->  Gather VecMotion 2:1  (slice1; segments: 2)
         ->  Vec Aggregate
               ->  Vec Seq Scan on tnulls
 Optimizer: Postgres query optimizer
(5 rows)

SELECT count(cint4), sum(cint4), avg(cint4), min(cint4), max(cint4), count(cint8), sum(cint8), avg(cint8), min(cint8), max(cint8), count(cint2), sum(cint2), avg(cint2), min(cint2), max(cint2), count(cdate), min(cdate), max(cdate), count(cts)  , min(cts)  , max(cts)  , count(ctext), min(ctext), max(ctext), count() FROM tnulls;
 count | sum | avg | min | max | count | sum | avg | min | max | count | sum | avg | min | max | count | min | max | count | min | max | count | min | max | count
-------+-----+-----+-----+-----+-------+-----+-----+-----+-----+-------+-----+-----+-----+-----+-------+-----+-----+-------+-----+-----+-------+-----+-----+-------
 0     |     |     |     |     | 0     |     |     |     |     | 0     |     |     |     |     | 0     |     |     | 0     |     |     | 0     |     |     | 2
(1 row)


-- distinct argument
EXPLAIN (costs off) SELECT count(DISTINCT cint4), sum(DISTINCT cint4), avg(DISTINCT cint4) FROM tnulls;
 QUERY PLAN
---------------------------------------------------
 Vec Aggregate
   ->  Gather VecMotion 2:1  (slice1; segments: 2)
         ->  Vec HashAggregate
               Group Key: tnulls.cint4
               ->  Vec Seq Scan on tnulls
 Optimizer: Postgres query optimizer
(6 rows)

EXPLAIN (costs off) SELECT count(DISTINCT cint8), sum(DISTINCT cint8), avg(DISTINCT cint8) FROM tnulls;
 QUERY PLAN
---------------------------------------------------------------------
 Vec Aggregate
   ->  Gather VecMotion 2:1  (slice2; segments: 2)
         ->  Vec HashAggregate
               Group Key: tnulls.cint8
               ->  Redistribute VecMotion 2:2  (slice1; segments: 2)
                     Hash Key: tnulls.cint8
                     ->  Vec HashAggregate
                           Group Key: tnulls.cint8
                           ->  Vec Seq Scan on tnulls
 Optimizer: Postgres query optimizer
(10 rows)

EXPLAIN (costs off) SELECT count(DISTINCT ctext) FROM tnulls;
 QUERY PLAN
---------------------------------------------------------------------
 Vec Aggregate
   ->  Gather VecMotion 2:1  (slice2; segments: 2)
         ->  Vec HashAggregate
               Group Key: tnulls.ctext
               ->  Redistribute VecMotion 2:2  (slice1; segments: 2)
                     Hash Key: tnulls.ctext
                     ->  Vec HashAggregate
                           Group Key: tnulls.ctext
                           ->  Vec Seq Scan on tnulls
 Optimizer: Postgres query optimizer
(10 rows)

SELECT count(DISTINCT cint4), sum(DISTINCT cint4), avg(DISTINCT cint4) FROM tnulls;
 count | sum | avg
-------+-----+-----
 0     |     |
(1 row)
SELECT count(DISTINCT cint8), sum(DISTINCT cint8), avg(DISTINCT cint8) FROM tnulls;
 count | sum | avg
-------+-----+-----
 0     |     |
(1 row)
SELECT count(DISTINCT cint2), sum(DISTINCT cint2), avg(DISTINCT cint2) FROM tnulls;
 count | sum | avg
-------+-----+-----
 0     |     |
(1 row)
SELECT count(DISTINCT ctext) FROM tnulls;
 count
-------
 0
(1 row)


-- *** group agg ***
ANALYZE tnulls;
ANALYZE

-- normal argument
set optimizer = on;
SET
EXPLAIN (costs off) SELECT avg(cint8), min(cint8), max(cint8), grpkey FROM tnulls GROUP BY grpkey ORDER BY grpkey;
 QUERY PLAN
---------------------------------------------------------------------------
 Gather VecMotion 2:1  (slice2; segments: 2)
   Merge Key: grpkey
   ->  Vec Sort
         Sort Key: grpkey
         ->  Vec GroupAggregate
               Group Key: grpkey
               ->  Vec Sort
                     Sort Key: grpkey
                     ->  Redistribute VecMotion 2:2  (slice1; segments: 2)
                           Hash Key: grpkey
                           ->  Vec Result
                                 ->  Vec GroupAggregate
                                       Group Key: grpkey
                                       ->  Vec Sort
                                             Sort Key: grpkey
                                             ->  Vec Seq Scan on tnulls
 Optimizer: Pivotal Optimizer (GPORCA)
(17 rows)

SELECT avg(cint8), min(cint8), max(cint8), grpkey FROM tnulls GROUP BY grpkey ORDER BY grpkey;
 avg | min | max | grpkey
-----+-----+-----+--------
     |     |     |
(1 row)

set optimizer = off;
SET
set enable_hashagg = off;
SET
EXPLAIN (costs off) SELECT count(cint4), sum(cint4), avg(cint4), min(cint4), max(cint4), count(cint8), sum(cint8), avg(cint8), min(cint8), max(cint8), count(cint2), sum(cint2), avg(cint2), min(cint2), max(cint2), count(cdate), min(cdate), max(cdate), count(cts)  , min(cts)  , max(cts)  , count(ctext), min(ctext), max(ctext), count(), grpkey FROM tnulls GROUP BY grpkey ORDER BY grpkey;
 QUERY PLAN
---------------------------------------------------------------------------
 Gather VecMotion 2:1  (slice2; segments: 2)
   Merge Key: tnulls.grpkey
   ->  Vec Sort
         Sort Key: tnulls.grpkey
         ->  Vec GroupAggregate
               Group Key: tnulls.grpkey
               ->  Vec Sort
                     Sort Key: tnulls.grpkey
                     ->  Redistribute VecMotion 2:2  (slice1; segments: 2)
                           Hash Key: tnulls.grpkey
                           ->  Vec GroupAggregate
                                 Group Key: tnulls.grpkey
                                 ->  Vec Sort
                                       Sort Key: tnulls.grpkey
                                       ->  Vec Seq Scan on tnulls
 Optimizer: Postgres query optimizer
(16 rows)

SELECT count(cint4), sum(cint4), avg(cint4), min(cint4), max(cint4), count(cint8), sum(cint8), avg(cint8), min(cint8), max(cint8), count(cint2), sum(cint2), avg(cint2), min(cint2), max(cint2), count(cdate), min(cdate), max(cdate), count(cts)  , min(cts)  , max(cts)  , count(ctext), min(ctext), max(ctext), count(), grpkey FROM tnulls GROUP BY grpkey ORDER BY grpkey;
 count | sum | avg | min | max | count | sum | avg | min | max | count | sum | avg | min | max | count | min | max | count | min | max | count | min | max | count | grpkey
-------+-----+-----+-----+-----+-------+-----+-----+-----+-----+-------+-----+-----+-----+-----+-------+-----+-----+-------+-----+-----+-------+-----+-----+-------+--------
 0     |     |     |     |     | 0     |     |     |     |     | 0     |     |     |     |     | 0     |     |     | 0     |     |     | 0     |     |     | 2     |
(1 row)

-- disinct argument
set optimizer = on;
SET

EXPLAIN (costs off) SELECT count(DISTINCT cint4), sum(DISTINCT cint4), avg(DISTINCT cint4), grpkey FROM tnulls GROUP BY grpkey ORDER BY grpkey;
 QUERY PLAN
---------------------------------------------------------------------------------------------------------------
 Gather VecMotion 2:1  (slice4; segments: 2)
   Merge Key: grpkey
   ->  Vec Sort
         Sort Key: grpkey
         ->  Vec GroupAggregate
               Group Key: grpkey
               ->  Vec Sort
                     Sort Key: grpkey
                     ->  Redistribute VecMotion 2:2  (slice3; segments: 2)
                           Hash Key: grpkey
                           ->  Vec GroupAggregate
                                 Group Key: grpkey, cint4
                                 ->  Vec Sort
                                       Sort Key: grpkey, cint4
                                       ->  Redistribute VecMotion 2:2  (slice2; segments: 2)
                                             Hash Key: grpkey, cint4
                                             ->  Vec GroupAggregate
                                                   Group Key: grpkey, cint4
                                                   ->  Vec Sort
                                                         Sort Key: grpkey, cint4
                                                         ->  Redistribute VecMotion 2:2  (slice1; segments: 2)
                                                               ->  Vec Seq Scan on tnulls
 Optimizer: Pivotal Optimizer (GPORCA)
(23 rows)

EXPLAIN (costs off) SELECT count(DISTINCT cint8), sum(DISTINCT cint8), avg(DISTINCT cint8), grpkey FROM tnulls GROUP BY grpkey ORDER BY grpkey;
 QUERY PLAN
---------------------------------------------------------------------------------------------
 Gather VecMotion 2:1  (slice3; segments: 2)
   Merge Key: grpkey
   ->  Vec Sort
         Sort Key: grpkey
         ->  Vec GroupAggregate
               Group Key: grpkey
               ->  Vec Sort
                     Sort Key: grpkey
                     ->  Redistribute VecMotion 2:2  (slice2; segments: 2)
                           Hash Key: grpkey
                           ->  Vec GroupAggregate
                                 Group Key: grpkey, cint8
                                 ->  Vec Sort
                                       Sort Key: grpkey, cint8
                                       ->  Redistribute VecMotion 2:2  (slice1; segments: 2)
                                             Hash Key: grpkey, cint8
                                             ->  Vec GroupAggregate
                                                   Group Key: grpkey, cint8
                                                   ->  Vec Sort
                                                         Sort Key: grpkey, cint8
                                                         ->  Vec Seq Scan on tnulls
 Optimizer: Pivotal Optimizer (GPORCA)
(22 rows)

EXPLAIN (costs off) SELECT count(DISTINCT ctext), grpkey FROM tnulls GROUP BY grpkey ORDER BY grpkey;
 QUERY PLAN
---------------------------------------------------------------------------------------------
 Gather VecMotion 2:1  (slice3; segments: 2)
   Merge Key: grpkey
   ->  Vec Sort
         Sort Key: grpkey
         ->  Vec GroupAggregate
               Group Key: grpkey
               ->  Vec Sort
                     Sort Key: grpkey
                     ->  Redistribute VecMotion 2:2  (slice2; segments: 2)
                           Hash Key: grpkey
                           ->  Vec GroupAggregate
                                 Group Key: grpkey, ctext
                                 ->  Vec Sort
                                       Sort Key: grpkey, ctext
                                       ->  Redistribute VecMotion 2:2  (slice1; segments: 2)
                                             Hash Key: grpkey, ctext
                                             ->  Vec GroupAggregate
                                                   Group Key: grpkey, ctext
                                                   ->  Vec Sort
                                                         Sort Key: grpkey, ctext
                                                         ->  Vec Seq Scan on tnulls
 Optimizer: Pivotal Optimizer (GPORCA)
(22 rows)

SELECT count(DISTINCT cint4), sum(DISTINCT cint4), avg(DISTINCT cint4), grpkey FROM tnulls GROUP BY grpkey ORDER BY grpkey;
 count | sum | avg | grpkey
-------+-----+-----+--------
 0     |     |     |
(1 row)
SELECT count(DISTINCT cint8), sum(DISTINCT cint8), avg(DISTINCT cint8), grpkey FROM tnulls GROUP BY grpkey ORDER BY grpkey;
 count | sum | avg | grpkey
-------+-----+-----+--------
 0     |     |     |
(1 row)
SELECT count(DISTINCT cint2), sum(DISTINCT cint2), avg(DISTINCT cint2), grpkey FROM tnulls GROUP BY grpkey ORDER BY grpkey;
 count | sum | avg | grpkey
-------+-----+-----+--------
 0     |     |     |
(1 row)
SELECT count(DISTINCT ctext), grpkey FROM tnulls GROUP BY grpkey ORDER BY grpkey;
 count | grpkey
-------+--------
 0     |
(1 row)
