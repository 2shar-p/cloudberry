set extra_float_digits = -1;;;
set default_table_access_method=ao_column;
set vector.enable_vectorization = on;
ANALYZE;
explain (costs off) select
	n_name,
	sum(l_extendedprice * (1 - l_discount)) as revenue
from
	customer,
	orders,
	lineitem,
	supplier,
	nation,
	region
where
	c_custkey = o_custkey
	and l_orderkey = o_orderkey
	and l_suppkey = s_suppkey
	and c_nationkey = s_nationkey
	and s_nationkey = n_nationkey
	and n_regionkey = r_regionkey
	and r_name = 'ASIA'
	and o_orderdate >= date '1993-01-01'
	and o_orderdate < date '1993-01-01' + interval '1 year'
group by
	n_name
order by
	revenue desc;
                                                                                          QUERY PLAN                                                                                           
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 Vec Gather Motion 3:1  (slice1; segments: 3)
   Merge Key: (sum((lineitem.l_extendedprice * ('1'::numeric(15,2) - lineitem.l_discount))))
   ->  Vec Sort
         Sort Key: (sum((lineitem.l_extendedprice * ('1'::numeric(15,2) - lineitem.l_discount)))) DESC
         ->  Vec Finalize Vec HashAggregate
               Group Key: nation.n_name
               ->  Vec Redistribute Motion 3:3  (slice2; segments: 3)
                     Hash Key: nation.n_name
                     ->  Vec Streaming Vec Partial Vec HashAggregate
                           Group Key: nation.n_name
                           ->  Vec Hash Join
                                 Hash Cond: ((lineitem.l_suppkey = supplier.s_suppkey) AND (customer.c_nationkey = supplier.s_nationkey))
                                 ->  Vec Hash Join
                                       Hash Cond: (lineitem.l_orderkey = orders.o_orderkey)
                                       ->  Vec Seq Scan on lineitem
                                       ->  Vec Hash
                                             ->  Vec Redistribute Motion 3:3  (slice3; segments: 3)
                                                   Hash Key: orders.o_orderkey
                                                   ->  Vec Hash Join
                                                         Hash Cond: (orders.o_custkey = customer.c_custkey)
                                                         ->  Vec Redistribute Motion 3:3  (slice4; segments: 3)
                                                               Hash Key: orders.o_custkey
                                                               ->  Vec Seq Scan on orders
                                                                     Filter: ((o_orderdate >= '01-01-1993'::date) AND (o_orderdate < 'Sat Jan 01 00:00:00 1994'::timestamp without time zone))
                                                         ->  Vec Hash
                                                               ->  Vec Hash Join
                                                                     Hash Cond: (customer.c_nationkey = nation.n_nationkey)
                                                                     ->  Vec Seq Scan on customer
                                                                     ->  Vec Hash
                                                                           ->  Vec Broadcast Motion 3:3  (slice5; segments: 3)
                                                                                 ->  Vec Hash Join
                                                                                       Hash Cond: (nation.n_regionkey = region.r_regionkey)
                                                                                       ->  Vec Seq Scan on nation
                                                                                       ->  Vec Hash
                                                                                             ->  Vec Broadcast Motion 3:3  (slice6; segments: 3)
                                                                                                   ->  Vec Seq Scan on region
                                                                                                         Filter: (r_name = 'ASIA'::text)
                                 ->  Vec Hash
                                       ->  Vec Broadcast Motion 3:3  (slice7; segments: 3)
                                             ->  Vec Seq Scan on supplier
 Optimizer: Pivotal Optimizer (GPORCA)
(41 rows)

select
	n_name,
	sum(l_extendedprice * (1 - l_discount)) as revenue
from
	customer,
	orders,
	lineitem,
	supplier,
	nation,
	region
where
	c_custkey = o_custkey
	and l_orderkey = o_orderkey
	and l_suppkey = s_suppkey
	and c_nationkey = s_nationkey
	and s_nationkey = n_nationkey
	and n_regionkey = r_regionkey
	and r_name = 'ASIA'
	and o_orderdate >= date '1993-01-01'
	and o_orderdate < date '1993-01-01' + interval '1 year'
group by
	n_name
order by
	revenue desc;
  n_name   |   revenue   
-----------+-------------
 CHINA     | 983411.7017
 INDONESIA | 907645.4944
 VIETNAM   | 862926.1382
 INDIA     | 629319.0326
 JAPAN     | 615315.0290
(5 rows)

